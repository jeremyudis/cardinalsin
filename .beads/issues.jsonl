{"id":"cardinalsin-1n1","title":"B8: Consolidate NANOS_PER_HOUR constant","description":"NANOS_PER_HOUR defined separately in local.rs:56 and s3.rs:98 plus inlined values. Move to a single shared constant in metadata/mod.rs. ~15 LOC.","status":"in_progress","priority":3,"issue_type":"task","created_at":"2026-02-09T09:28:33.594983-07:00","created_by":"jeremyudis","updated_at":"2026-02-09T09:30:11.203983-07:00"}
{"id":"cardinalsin-2q1","title":"D-integration: WAL integration into ingester write path + recovery protocol","description":"After WAL core: Integrate WAL into Ingester::write(), add truncation after S3 flush, implement recovery protocol on startup, integrate with dual-write path. Add integration tests for crash recovery. ~390 LOC. Depends on: D-core. Touches: src/ingester/mod.rs.","notes":"Depends on WAL core (cardinalsin-b9n). Follow-ups created: cardinalsin-am0 (recovery), cardinalsin-vla (flush+truncation), cardinalsin-3bm (config), cardinalsin-d6s (ack semantics).","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-09T09:28:55.694823-07:00","created_by":"jeremyudis","updated_at":"2026-02-10T21:42:16.852973-07:00","closed_at":"2026-02-10T21:42:16.852973-07:00","close_reason":"WAL integrated into ingester write path with recovery and truncation","labels":["wal"],"dependencies":[{"issue_id":"cardinalsin-2q1","depends_on_id":"cardinalsin-b9n","type":"blocks","created_at":"2026-02-09T09:29:52.769009-07:00","created_by":"jeremyudis"}]}
{"id":"cardinalsin-306","title":"B1: Extract with_cas_retry helper from 9 copy-pasted retry loops in s3.rs","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-08T22:14:23.024521-07:00","created_by":"jeremyudis","updated_at":"2026-02-16T15:36:32.20702-07:00","closed_at":"2026-02-16T15:36:32.20702-07:00","close_reason":"Extracted cas_retry! macro, refactored all 9 loops. PR #19"}
{"id":"cardinalsin-3bm","title":"D-core: WAL config/env plumbing","description":"Wire WAL config to environment/config: WAL_ENABLED, WAL_DIR, WAL_SYNC_MODE, WAL_MAX_SEGMENT_SIZE. Document defaults.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-10T00:09:34.40873-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T00:25:29.570739-07:00","closed_at":"2026-02-12T00:25:29.570739-07:00","close_reason":"WAL env vars wired: WAL_ENABLED, WAL_DIR, WAL_SYNC_MODE, WAL_MAX_SEGMENT_SIZE"}
{"id":"cardinalsin-3ih","title":"E10: Fix initialization-only and println-only tests","description":"3 tests only verify initialization (e.g. Arc::strong_count >= 1). Several tests only println! results without assertions. Add real assertions that verify behavior. ~250 LOC. Touches: tests/adaptive_indexing_tests.rs, others.","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2026-02-09T09:29:14.74649-07:00","created_by":"jeremyudis","updated_at":"2026-02-09T09:30:10.944518-07:00"}
{"id":"cardinalsin-4tn","title":"E6: Query chunk pinning / extend GC grace period","description":"Long queries fail with S3 NotFound if compaction GC deletes chunks during execution. Current 60s grace too short. Implement chunk pinning (~200 LOC) or extend grace to 5-10 min as interim. Depends on: E1-E5 compaction leasing.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-09T09:29:05.206566-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T09:42:11.491164-07:00","closed_at":"2026-02-12T09:42:11.491164-07:00","close_reason":"PR #8 - chunk pin registry + GC grace period extended to 5min","dependencies":[{"issue_id":"cardinalsin-4tn","depends_on_id":"cardinalsin-iry","type":"blocks","created_at":"2026-02-09T09:29:52.862668-07:00","created_by":"jeremyudis"}]}
{"id":"cardinalsin-5sv","title":"C-tooling: AtomicJsonStore<T> generic extraction + migration tool + tests","description":"After catalog core is done: Extract AtomicJsonStore<T> to reduce s3.rs by ~60%. Build migrate-metadata binary for format migration. Add tests for single-file atomicity. ~450 LOC. Depends on: Phase C core and B1 (retry extraction).","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-09T09:28:48.655081-07:00","created_by":"jeremyudis","updated_at":"2026-02-09T09:28:48.655081-07:00","dependencies":[{"issue_id":"cardinalsin-5sv","depends_on_id":"cardinalsin-xjy","type":"blocks","created_at":"2026-02-09T09:29:52.586872-07:00","created_by":"jeremyudis"},{"issue_id":"cardinalsin-5sv","depends_on_id":"cardinalsin-306","type":"blocks","created_at":"2026-02-09T09:29:52.682305-07:00","created_by":"jeremyudis"}]}
{"id":"cardinalsin-69s","title":"F1: Shard split crash safety - persistent state machine","description":"Split failure leaves system in unrecoverable state. Add persistent state machine that tracks phase progress and can resume from any point. ~400 LOC. Depends on: Phase C (metadata merge simplifies state persistence). Touches: src/sharding/splitter.rs.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-09T09:29:23.941882-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T15:07:39.952318-07:00","closed_at":"2026-02-12T15:07:39.952318-07:00","close_reason":"Persistent state machine with SplitProgress tracking all 5 phases + cutover fencing. PR #17.","dependencies":[{"issue_id":"cardinalsin-69s","depends_on_id":"cardinalsin-xjy","type":"blocks","created_at":"2026-02-09T09:29:52.952835-07:00","created_by":"jeremyudis"}]}
{"id":"cardinalsin-87x","title":"B10: Fix from_sql case-sensitivity in streaming predicates","description":"src/query/streaming.rs from_sql lowercases string predicate values, breaking case-sensitive queries. Fix: don't lowercase values, only lowercase column names. ~10 LOC.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T09:28:37.573267-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T00:28:29.108964-07:00","closed_at":"2026-02-12T00:28:29.108964-07:00","close_reason":"No bug found - values already case-sensitive. Added PartialEq + 2 regression tests."}
{"id":"cardinalsin-88u","title":"B4: Migrate error.rs to thiserror, fix serde_json error chain loss","description":"Replace hand-rolled Display/Error impls with thiserror derive macros. Fix From<serde_json::Error> losing type info. Resolve ShardError/ShardNotFound redundancy. ~110 LOC changed. Touches: src/error.rs and all files matching on Error variants.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-09T09:28:29.663964-07:00","created_by":"jeremyudis","updated_at":"2026-02-10T10:30:07.631923-07:00","closed_at":"2026-02-10T10:30:07.631923-07:00","close_reason":"Migrated error.rs to thiserror derives. 58 lines of boilerplate removed (157->99 LOC). Fixed ShardError Display, removed redundant ShardError::NotFound. All 68 lib tests pass."}
{"id":"cardinalsin-8tt","title":"F7: Shard router generation validation","description":"ShardRouter::get_shard() only uses TTL-based cache expiry, no generation validation. Stale entries route writes to split shards. Add generation check. ~50 LOC. Touches: src/sharding/router.rs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T09:29:39.018881-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T10:32:39.293893-07:00","closed_at":"2026-02-12T10:32:39.293893-07:00","close_reason":"PR #12 - generation validation + active-state check in ShardRouter"}
{"id":"cardinalsin-9lt","title":"B3: Add complete_compaction target chunk validation guard","notes":"PR review confirmed: complete_compaction silently does nothing if target chunk not in catalog. Need validation guard.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-08T22:14:23.28182-07:00","created_by":"jeremyudis","updated_at":"2026-02-10T21:07:44.853754-07:00","closed_at":"2026-02-10T21:07:44.853754-07:00","close_reason":"P0-P1 fixes applied: WAL crash-tolerant recovery, WAL init warning, PutMode::Create for first write, complete_compaction target validation"}
{"id":"cardinalsin-9y6","title":"F6: Fix CachedObjectStore metadata fabrication","description":"CachedObjectStore::get fabricates ObjectMeta with current timestamp instead of real metadata. Breaks ETag-based caching. ~30 LOC. Touches: src/query/cache.rs.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-09T09:29:37.046133-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T14:51:55.402268-07:00","closed_at":"2026-02-12T14:51:55.402268-07:00","close_reason":"Fixed metadata fabrication via OnceLock side-channel. PR #13."}
{"id":"cardinalsin-am0","title":"D-core: WAL recovery + replay into buffer","description":"Implement WAL recovery at ingester startup: open WAL, read entries after last flushed seq, append to buffer, handle CRC/truncation cases, and truncate already-flushed segments.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-10T00:09:24.139142-07:00","created_by":"jeremyudis","updated_at":"2026-02-10T21:42:16.981928-07:00","closed_at":"2026-02-10T21:42:16.981928-07:00","close_reason":"Recovery implemented in ensure_wal() - replays entries after last flushed seq"}
{"id":"cardinalsin-b9n","title":"D-core: WAL segment management, entry format, config, unit tests","description":"CRITICAL: Eliminate 5-min data loss window on ingester crash. Implement Arrow IPC WAL per docs/design-wal.md. Create src/ingester/wal.rs with segment file management, WalConfig/WalSyncMode, CRC32 integrity, segment rotation. Add unit tests for CRC, rotation, truncation, corruption. Add Error::WalFull variant. ~350 LOC. Touches: src/ingester/wal.rs (new), src/error.rs. PARALLEL with Phase C (no file overlap).","notes":"Reopened: PR review found truncated WAL entry aborts recovery (should skip trailing incomplete entry, not error). Also init_wal() always returns None with no warning on write path.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-09T09:28:53.44773-07:00","created_by":"jeremyudis","updated_at":"2026-02-10T21:07:44.799047-07:00","closed_at":"2026-02-10T21:07:44.799047-07:00","close_reason":"P0-P1 fixes applied: WAL crash-tolerant recovery, WAL init warning, PutMode::Create for first write, complete_compaction target validation"}
{"id":"cardinalsin-buf","title":"B7: Deduplicate split_batch implementations","description":"Two identical split_batch_by_timestamp implementations exist: src/ingester/mod.rs:283 and src/sharding/splitter.rs:230. Extract to shared function in sharding module. ~50 LOC.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-02-09T09:28:31.551419-07:00","created_by":"jeremyudis","updated_at":"2026-02-09T09:30:11.119325-07:00"}
{"id":"cardinalsin-bxh","title":"F5: Unify predicate type systems between streaming and engine","description":"Duplicate predicate extraction exists in streaming.rs and engine.rs. Unify into single type system. ~100 LOC. Touches: src/query/streaming.rs, src/query/engine.rs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T09:29:35.469969-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T10:30:45.292717-07:00","closed_at":"2026-02-12T10:30:45.292717-07:00","close_reason":"PR #11 - unified predicate types, streaming uses ColumnPredicate"}
{"id":"cardinalsin-d6s","title":"D-core: WAL ack/fsync semantics decision","description":"Decide ack behavior (after WAL append vs after fsync). Update write path + tests accordingly.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-10T00:09:47.795841-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T00:25:29.669674-07:00","closed_at":"2026-02-12T00:25:29.669674-07:00","close_reason":"Ack after WAL append (not fsync), documented on write() method"}
{"id":"cardinalsin-exk","title":"E11: Fix trivially-true assertion tests","description":"Several tests have assertions that are always true (e.g. assert!(x >= 0) for unsigned). Replace with meaningful assertions. ~80 LOC. Touches: various test files.","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2026-02-09T09:29:19.530517-07:00","created_by":"jeremyudis","updated_at":"2026-02-09T09:30:11.03123-07:00"}
{"id":"cardinalsin-iry","title":"E1-E5: Compaction leasing implementation","description":"Implement per docs/design-compaction-leasing.md. Add CompactionLease/LeaseStatus/CompactionLeases types, compaction_leases_path(), lease CRUD with CAS, integrate into compact_l0/compact_level, add lease renewal background task, add scavenging. Add Error::ChunksAlreadyLeased. Add node_id to Compactor. ~580 LOC. Depends on: Phase C (benefits from AtomicJsonStore but not strictly required).","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-09T09:29:00.210308-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T09:33:32.024774-07:00","closed_at":"2026-02-12T09:33:32.024774-07:00","close_reason":"PR #7 - Full compaction leasing implementation per design doc: CAS-based S3 leases, lease renewal, scavenging, 17 integration tests"}
{"id":"cardinalsin-jey","title":"B2: MinIO CAS fallback - fail loud instead of silent PutMode::Overwrite","notes":"2026-02-16: Tightening MinIO behavior: CAS remains default-safe (fail loud), with explicit allow_unsafe_overwrite opt-in for local MinIO-only workflows. Adding regression tests for both disabled and enabled modes.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T22:14:23.155722-07:00","created_by":"jeremyudis","updated_at":"2026-02-16T16:05:07.467313-07:00","closed_at":"2026-02-16T16:05:07.467313-07:00","close_reason":"Implemented safe-by-default CAS behavior for MinIO/object stores without conditional PUT support; unsafe overwrite is explicit opt-in via allow_unsafe_overwrite/S3_METADATA_ALLOW_UNSAFE_OVERWRITE. Added regression tests for fail-loud default and explicit opt-in fallback."}
{"id":"cardinalsin-mgk","title":"F3: Shard split cutover atomicity with fencing tokens","description":"Cutover makes 3 separate update_shard_metadata calls without fencing. Crash between them leaves partial key space coverage. Add fencing tokens. ~150 LOC. Touches: src/sharding/splitter.rs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T09:29:28.380937-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T15:04:03.662104-07:00","closed_at":"2026-02-12T15:04:03.662104-07:00","close_reason":"Added CutoverIntent with fencing tokens and resume_cutover(). PR #16."}
{"id":"cardinalsin-q8u","title":"E8: Persist pending_deletions across compactor restarts","description":"pending_deletions is RwLock<Vec> in-memory only. Compactor restart loses all pending deletions, leaking S3 storage. Persist to S3 file. ~40 LOC. Touches: src/compactor/mod.rs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T09:29:09.721396-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T10:03:34.885395-07:00","closed_at":"2026-02-12T10:03:34.885395-07:00","close_reason":"PR #9 - pending_deletions persisted to S3"}
{"id":"cardinalsin-s6s","title":"E9: Fix 12 tests that accept both Ok and Err","description":"~12 integration tests use patterns like 'assert\\!(result.is_ok() || result.is_err())' or match both Ok/Err arms identically. These provide zero regression value. Fix each to assert specific expected outcomes. ~200 LOC. Touches: tests/shard_split_tests.rs, tests/cluster_tests.rs, others.","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2026-02-09T09:29:12.45121-07:00","created_by":"jeremyudis","updated_at":"2026-02-09T09:30:10.856249-07:00"}
{"id":"cardinalsin-t86","title":"E7: Clean up unbounded compaction job list","description":"CompactionStatus::Completed/Failed jobs never removed from compaction-jobs.json. File grows unbounded. Add cleanup of completed/failed jobs older than TTL in run_compaction_cycle(). ~60 LOC. Touches: src/metadata/s3.rs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T09:29:07.577064-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T00:36:59.208258-07:00","closed_at":"2026-02-12T00:36:59.208258-07:00","close_reason":"PR #6 - TTL cleanup for compaction jobs with created_at timestamp, CAS-safe S3 impl, 1hr TTL in compaction cycle"}
{"id":"cardinalsin-tu8","title":"B6: Replace DefaultHasher with stable hash for shard keys","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-02-08T22:14:23.407938-07:00","created_by":"jeremyudis","updated_at":"2026-02-09T09:30:10.768763-07:00"}
{"id":"cardinalsin-u57","title":"B9: Remove unused dependencies (once_cell, config, hex)","description":"once_cell (line 110), config (line 120), hex are in Cargo.toml but unused. Remove them to speed up compile times. ~10 LOC. Verify with cargo check.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-09T09:28:35.562215-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T14:56:56.100561-07:00","closed_at":"2026-02-12T14:56:56.100561-07:00","close_reason":"Removed once_cell, config, hex. PR #14."}
{"id":"cardinalsin-vis","title":"F2: Dual-write deduplication during shard split","description":"During dual-write phase, data exists in both old and new shards. Queries return duplicates. Add dedup mechanism. ~150 LOC. Depends on: F1. Touches: src/ingester/mod.rs, src/query/engine.rs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T09:29:26.046198-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T15:11:59.258465-07:00","closed_at":"2026-02-12T15:11:59.258465-07:00","close_reason":"Added dedup_batches() and has_active_split() for dual-write dedup. PR #18.","dependencies":[{"issue_id":"cardinalsin-vis","depends_on_id":"cardinalsin-69s","type":"blocks","created_at":"2026-02-09T09:29:53.038345-07:00","created_by":"jeremyudis"}]}
{"id":"cardinalsin-vla","title":"D-core: WAL flush integration + truncation","description":"Integrate WAL truncation with successful flush to S3/metadata. Persist last flushed seq, truncate WAL segments, and wire in flush path.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-10T00:09:30.182218-07:00","created_by":"jeremyudis","updated_at":"2026-02-10T21:42:17.115037-07:00","closed_at":"2026-02-10T21:42:17.115037-07:00","close_reason":"Flush integration done - truncate_before + persist_flushed_seq after S3 flush"}
{"id":"cardinalsin-xcw","title":"E12: Add graceful shutdown to all service loops","description":"run_flush_timer and Compactor::run use infinite loops with no CancellationToken or shutdown signal. Add tokio watch/CancellationToken for clean shutdown. ~100 LOC. Touches: src/ingester/mod.rs, src/compactor/mod.rs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T09:29:21.561779-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T10:06:41.52939-07:00","closed_at":"2026-02-12T10:06:41.52939-07:00","close_reason":"PR #10 - CancellationToken for Compactor and Ingester"}
{"id":"cardinalsin-xjy","title":"C: Metadata merge - unify metadata.json + time-index.json into catalog.json","description":"CRITICAL: Eliminate non-atomic two-file CAS (#1 finding in both audits). Implement design from docs/design-metadata-merge.md. Add MetadataCatalog struct with shard_id field, implement load_catalog_with_etag() with dual-read fallback, atomic_save_catalog() single-file CAS, rewrite atomic_register_chunk/delete_chunk/complete_compaction to use catalog, replace dual cache with single catalog_cache, update get_chunks_for_shard to use shard_id field. ~480 LOC core. Touches: src/metadata/s3.rs primarily.","notes":"Reopened: PR review found first catalog write uses PutMode::Overwrite (should be Create), and legacy fallback discards ETags defeating CAS during migration.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-09T09:28:45.510079-07:00","created_by":"jeremyudis","updated_at":"2026-02-10T21:07:44.826496-07:00","closed_at":"2026-02-10T21:07:44.826496-07:00","close_reason":"P0-P1 fixes applied: WAL crash-tolerant recovery, WAL init warning, PutMode::Create for first write, complete_compaction target validation"}
{"id":"cardinalsin-zxy","title":"F4: Clock skew mitigation for timestamps","description":"Uses chrono::Utc::now() for chunk paths and retention. Clock skew causes premature deletion or retention violations. Add hybrid logical clock or NTP-aware bounds. ~80 LOC.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-09T09:29:33.669465-07:00","created_by":"jeremyudis","updated_at":"2026-02-12T15:00:41.020078-07:00","closed_at":"2026-02-12T15:00:41.020078-07:00","close_reason":"Added BoundedClock with monotonic guarantees and skew-safe retention. PR #15."}
