#!/usr/bin/env bash

set -euo pipefail

echo "Running pre-commit checks..."

# 1. cargo fmt check
if ! cargo fmt -- --check 2>/dev/null; then
    echo "error: rustfmt check failed. Run 'cargo fmt' to fix." >&2
    exit 1
fi

# 2. cargo clippy
if ! cargo clippy --all-targets --all-features -- -D warnings 2>/dev/null; then
    echo "error: clippy check failed. Fix warnings before committing." >&2
    exit 1
fi

# 3. Chain beads hook if bd is available
if command -v bd >/dev/null 2>&1; then
    bd hook pre-commit "$@"
fi
